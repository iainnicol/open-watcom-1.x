#
#read asm source file
#
read %1.asm
#
# convert each asm source line to c pragma aux line
#
%s/^.*$/extern void p\#( void );\n#pragma aux p\# = "&"\nvoid r\#( void ) { p\#(); }
#
# C++ open
#
insert
>#ifdef __cplusplus
>extern "C" {
>#endif
>int	x;
.
#
# initialize procesor intruction set
#
if ( %2 == "K3D" )
insert
>#pragma aux pinit0=".586p"
>#pragma aux pinit1=".K3D"
>#pragma aux pinit2=".387"
.
elseif ( %2 == "MMX" )
insert
>#pragma aux pinit0=".586p"
>#pragma aux pinit1=".MMX"
>#pragma aux pinit2=".387"
.
elseif ( %2 == "XMM" )
insert
>#pragma aux pinit0=".686p"
>#pragma aux pinit1=".XMM"
>#pragma aux pinit2=".387"
.
elseif ( %2 == "XMM2" )
insert
>#pragma aux pinit0=".686p"
>#pragma aux pinit1=".XMM2"
>#pragma aux pinit2=".387"
.
elseif ( %2 == "XMM3" )
insert
>#pragma aux pinit0=".686p"
>#pragma aux pinit1=".XMM3"
>#pragma aux pinit2=".387"
.
else
insert
>#pragma aux pinit0=".486p"
>#pragma aux pinit1=".387"
.
endif
#
# C++ close
#
$ append
>#ifdef __cplusplus
>}
>#endif
.
write! %1.c
quit!
